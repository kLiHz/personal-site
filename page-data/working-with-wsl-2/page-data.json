{"componentChunkName":"component---src-templates-blog-post-js","path":"/working-with-wsl-2/","result":{"data":{"site":{"siteMetadata":{"title":"kLiHb's Blog"}},"markdownRemark":{"id":"4fbac9c9-ef8f-502e-8202-07507e118389","excerpt":"了解 WSL 2 : 适用于 Linux 的 Windows 子系统文档 - Microsoft Docs (微软文档) 为什么使用 WSL? : 为什么这么多人吹 WSL? - 知乎 Installation 安装 WSL 2: 设置 WSL 开发环境 - Microsoft Docs ... Networking…","html":"<p>了解 WSL 2 : <a href=\"https://docs.microsoft.com/zh-cn/windows/wsl/\">适用于 Linux 的 Windows 子系统文档 - Microsoft Docs</a> (微软文档)</p>\n<p>为什么使用 WSL? : <a href=\"https://www.zhihu.com/question/393170756\">为什么这么多人吹 WSL? - 知乎</a></p>\n<h2>Installation</h2>\n<p>安装 WSL 2: <a href=\"https://docs.microsoft.com/zh-cn/windows/wsl/setup/environment\">设置 WSL 开发环境 - Microsoft Docs</a></p>\n<p>...</p>\n<h2>Networking</h2>\n<p>最主要的是网络问题. 一般日常工作需要, 需要 WSL2 和主机能够互相访问.</p>\n<p>WSL 2 作为 Hyper-V 虚拟机运行, 不同于 WSL 1 的桥接, 其使用网络地址转换 (NAT) 服务作为其虚拟网络 <sup id=\"fnref-compare-versions\"><a href=\"#fn-compare-versions\" class=\"footnote-ref\">compare-versions</a></sup>. 因此, 主机和 WSL 2 需要首先得知对方在该虚拟网络下的 IP 地址才能互相通信. 需要注意, 每次重启主机, 该 IP 地址都会发生变化.</p>\n<p>可以通过下面的方法获取主机和 WSL 2 的 IP <sup id=\"fnref-get-ip\"><a href=\"#fn-get-ip\" class=\"footnote-ref\">get-ip</a></sup>:</p>\n<p>在运行的 WSL 2 上, 可以通过访问  <code class=\"language-text\">/etc/resolv.conf</code>, 从而得知主机在该网络下的地址:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"command-line-prompt\"><span data-user=henry data-host=localhost></span><span></span><span></span><span></span><span></span><span data-user=henry data-host=localhost></span><span></span></span><span class=\"token function\">cat</span> /etc/resolv.conf\n<span class=\"token comment\"># This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:</span>\n<span class=\"token comment\"># [network]</span>\n<span class=\"token comment\"># generateResolvConf = false</span>\nnameserver <span class=\"token number\">172.21</span>.160.1\n<span class=\"token function\">cat</span> /etc/resolv.conf <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> nameserver <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> '<span class=\"token punctuation\">{</span> print <span class=\"token variable\">$2</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">172.21</span>.160.1</code></pre></div>\n<p>可以通过 <code class=\"language-text\">hostname -I</code> 得到 WSL 2 的 IP.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"command-line-prompt\"><span data-user=henry data-host=localhost></span><span></span></span><span class=\"token function\">hostname</span> -I <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'{print $1}'</span>\n<span class=\"token number\">172.21</span>.172.66 </code></pre></div>\n<p>但是, 要想 WSL 2 成功访问主机, 还需要主机放开防火墙规则. 可以参考下面的 PowerShell 命令 (需要管理员权限) <sup id=\"fnref-disable-win-firewall\"><a href=\"#fn-disable-win-firewall\" class=\"footnote-ref\">disable-win-firewall</a></sup>, 解除 Windows 主机上针对 WSL 虚拟网卡的防火墙规则:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token comment\"># 直接放开 `vEthernet (WSL)` 这张网卡的防火墙</span>\n<span class=\"token function\">New-NetFirewallRule</span> <span class=\"token operator\">-</span>DisplayName <span class=\"token string\">\"WSL\"</span> <span class=\"token operator\">-</span>Direction Inbound <span class=\"token operator\">-</span>InterfaceAlias <span class=\"token string\">\"vEthernet (WSL)\"</span> <span class=\"token operator\">-</span>Action Allow</code></pre></div>\n<h3>Proxy</h3>\n<p>从前文可以看出, WSL 2 的网络配置略显复杂, 因此先考虑在 WSL2 上直接运行代理程序 (Clash), 未果, 不能与网络代理服务提供商的服务器正常通信 (猜测可能是时区问题).</p>\n<p>折腾许久不得, 于是作罢, 还是尝试使用主机上运行的代理程序.</p>\n<p>WSL 2 对主机上程序的访问, 相当于来自局域网的访问. 因此, 需要打开代理软件 \"<strong>允许来自局域网的连接</strong> (Allow LAN)\" 的设置. 同时, 除了前文说到的 <strong>放行 WSL 2 的网卡</strong> 外, 还需要 <strong>允许代理软件通过防火墙</strong> <sup id=\"fnref-pass-firewall\"><a href=\"#fn-pass-firewall\" class=\"footnote-ref\">pass-firewall</a></sup> (可能会在第一次开启代理软件的 \"Allow LAN\" 的时候弹出提醒).</p>\n<p>之后, 便可以在 WSL 2 上使用主机上的代理了.</p>\n<p>备注: 尚未研究 SSH 的代理. 可以参考:</p>\n<p><a href=\"https://github.com/wizcas/wsl2proxy\">wizcas/wsl2proxy - github.com</a></p>\n<h3>端口转发</h3>\n<p>从局域网访问主机上的 WSL 2, 可以参考; 因本人暂无需求, 故尚未研究. 下面仅备注一些可能相关的链接.</p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/425312804\">如何在局域网的其他主机上中访问本机的 WSL2 - 知乎</a></p>\n<p><a href=\"https://ruihusky.github.io/ruihusky/posts/2020-12-11_wsl2-net-config/\">Windows 10 WSL 2 网络配置 | ruihusky's Blog</a></p>\n<h2>File System</h2>\n<p>虽然 Windows 的文件系统挂载在了 WSL 2 上, Windows 中也可以直接在资源管理器中访问 WSL 2 上的文件系统. 但是建议, 在可能的情况下, 还是将文件放在 WSL 2 中处理, 尽量不要跨系统进行操作.</p>\n<h2>Misc</h2>\n<p><a href=\"https://xiabee.cn/coding/wsl2/\">WSL 2 踩坑分享 - xiabee</a></p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-compare-versions\"><a href=\"https://docs.microsoft.com/zh-cn/windows/wsl/compare-versions\">比较 WSL 1 和 WSL 2 - Microsoft Docs</a><a href=\"#fnref-compare-versions\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-get-ip\"><a href=\"https://zinglix.xyz/2020/04/18/wsl2-proxy/#wsl-%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%AE%BF%E4%B8%BB%E6%9C%BA-ip\">#WSL 中获取宿主机 IP - WSL 2 中访问宿主机 Windows 的代理 - ZingLix Blog</a><a href=\"#fnref-get-ip\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-disable-win-firewall\">来自 <a href=\"https://bytem.io/posts/wsl2-network-tricks/\">WSL 2 的一些网络访问问题 | Artin's Blog (bytem.io)</a>, 引用自 <a href=\"https://github.com/microsoft/WSL/issues/4585\">Issue #4585 · microsoft/WSL</a>. 前者还提到了使用 TUN 模式代理整张网卡的流量.<a href=\"#fnref-disable-win-firewall\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-pass-firewall\"><a href=\"https://zhuanlan.zhihu.com/p/144583887\">WSL 2 来了! 但是能正常使用并不简单 - Wizcas - 知乎</a> (Also available at <a href=\"https://0x1c.dev/blog/dev/make-wsl2-right/\">0x1C.dev</a>); 该文章参考了 <a href=\"https://blog.rogerkung-win.top/posts/38819/\">在 WSL 2 中访问主机代理 - Geek 成长路 (rogerkung-win.top)</a>.<a href=\"#fnref-pass-firewall\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","frontmatter":{"title":"使用 WSL 2 进行工作","date":"May 19, 2022","description":"WSL 2 使用过程中的一些注意事项."}},"previous":{"fields":{"slug":"/drawio-svg-exports/"},"frontmatter":{"title":"关于 draw.io 矢量图 SVG 导出的研究"}},"next":{"fields":{"slug":"/hello-gatsby/"},"frontmatter":{"title":"Hello, Gatsby!"}}},"pageContext":{"id":"4fbac9c9-ef8f-502e-8202-07507e118389","previousPostId":"061ad949-6019-5e3a-af18-f73dc63d76c5","nextPostId":"fe3b1427-a238-56b2-b493-8fb5d8d2ccb2"}},"staticQueryHashes":["2841359383","4049601996"]}